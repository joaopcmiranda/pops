// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  trips          Trip[]
  itineraryItems ItineraryItem[]
  contentItems   ContentItem[]
  collaborations TripCollaborator[]

  @@map("users")
}

model Person {
  id               String  @id @default(cuid())
  name             String
  relationshipType String // 'family' | 'friend' | 'colleague' | 'contact'
  phone            String?
  email            String?
  whatsapp         String?
  notes            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  itineraryItems ItineraryItem[]

  @@map("people")
}

model Location {
  id          String  @id @default(cuid())
  name        String
  address     String?
  city        String
  state       String?
  latitude    Float?
  longitude   Float?
  type        String // 'venue' | 'accommodation' | 'workplace' | 'tourist-spot' | 'restaurant' | 'other'
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  itineraryItems ItineraryItem[]

  @@map("locations")
}

model ItineraryItem {
  id          String   @id @default(cuid())
  title       String
  description String?
  type        String   // ItemType enum
  startDate   DateTime
  endDate     DateTime?
  isAllDay    Boolean  @default(false)
  status      String   @default("planned") // 'planned' | 'confirmed' | 'completed' | 'cancelled'
  priority    String   @default("medium")  // 'low' | 'medium' | 'high'
  tags        String?  // JSON array of strings
  notes       String?
  
  // Type-specific fields (stored as JSON)
  typeData    String?  // JSON object with type-specific data
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  tripId     String
  trip       Trip      @relation(fields: [tripId], references: [id], onDelete: Cascade)
  userId     String
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  locationId String?
  location   Location? @relation(fields: [locationId], references: [id], onDelete: SetNull)
  attendees  Person[]

  @@map("itinerary_items")
}

model ContentItem {
  id        String   @id @default(cuid())
  category  String
  title     String
  content   String
  slug      String   @unique
  tags      String?  // JSON array of strings
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tripId String
  trip   Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("content_items")
}

model Trip {
  id          String   @id @default(cuid())
  title       String
  description String?
  destination String
  country     String
  type        String   // TripType enum
  status      String   @default("planning") // TripStatus enum
  
  // Dates
  startDate   DateTime
  endDate     DateTime
  
  // Settings and budget (stored as JSON)
  budget      String?  // JSON TripBudget object
  settings    String   // JSON TripSettings object
  
  // Metadata
  coverImage  String?
  tags        String?  // JSON array of strings
  isTemplate  Boolean  @default(false)
  templateId  String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  userId          String
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  collaborators   TripCollaborator[]
  itineraryItems  ItineraryItem[]
  contentItems    ContentItem[]

  @@map("trips")
}

model TripCollaborator {
  id          String   @id @default(cuid())
  role        String   // 'viewer' | 'editor' | 'admin'
  permissions String   // JSON permissions object
  invitedAt   DateTime @default(now())
  acceptedAt  DateTime?
  invitedBy   String   // User ID who sent the invitation
  
  // Relations
  tripId      String
  trip        Trip     @relation(fields: [tripId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tripId, userId])
  @@map("trip_collaborators")
}

model TripTemplate {
  id                String   @id @default(cuid())
  title             String
  description       String
  destination       String
  country           String
  type              String   // TripType enum
  duration          Int      // days
  tags              String   // JSON array of strings
  
  // Template data
  itineraryTemplate String   // JSON
  contentTemplate   String   // JSON
  
  // Metadata
  createdBy         String   // User ID
  isPublic          Boolean  @default(false)
  usageCount        Int      @default(0)
  rating            Float?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("trip_templates")
}