/**
 * Tests for theme store
 */
import { describe, it, expect, beforeEach } from "vitest";
import { useThemeStore } from "./themeStore";

describe("themeStore", () => {
  beforeEach(() => {
    // Reset store state before each test
    useThemeStore.setState({ theme: "dark" });
  });

  it("should have dark as default theme", () => {
    const { theme } = useThemeStore.getState();
    expect(theme).toBe("dark");
  });

  it("should toggle theme from dark to light", () => {
    const { toggleTheme } = useThemeStore.getState();
    toggleTheme();

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("light");
  });

  it("should toggle theme from light to dark", () => {
    useThemeStore.setState({ theme: "light" });
    const { toggleTheme } = useThemeStore.getState();
    toggleTheme();

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("dark");
  });

  it("should set theme directly to light", () => {
    const { setTheme } = useThemeStore.getState();
    setTheme("light");

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("light");
  });

  it("should set theme directly to dark", () => {
    useThemeStore.setState({ theme: "light" });
    const { setTheme } = useThemeStore.getState();
    setTheme("dark");

    const { theme } = useThemeStore.getState();
    expect(theme).toBe("dark");
  });

  it("should persist theme to localStorage", () => {
    const { setTheme } = useThemeStore.getState();
    setTheme("light");

    // Simulate page reload by creating new store instance
    const persistedTheme = localStorage.getItem("pops-theme-storage");
    expect(persistedTheme).toBeTruthy();

    if (persistedTheme) {
      const parsed = JSON.parse(persistedTheme);
      expect(parsed.state.theme).toBe("light");
    }
  });
});
